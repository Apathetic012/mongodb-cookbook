rs.initiate({
  _id: "<%= node[:mongodb][:server][:replica_set] %>",
  members: [
    {
      _id: <%= node[:mongodb][:server][:replica_member_id] %>,
      host: "localhost:<%= node[:mongodb][:server][:port] %>"
    }
  ]
});

<% @members.each do |member| %>
  <% next if node.fqdn == member.fqdn %>
  rs.add({
    _id: <%= member[:mongodb][:server][:replica_member_id] %>,
    host: "localhost:<%= member[:mongodb][:server][:port] %>",
    priority: <%= member[:mongodb][:server][:replica_priority] %>
  });
<% end %>

