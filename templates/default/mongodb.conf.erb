# THIS FILE HAS BEEN GENERATED BY CHEF
# ANY MANUAL MODIFICATIONS WILL BE OVERWRITTEN
# mongodb.conf

# Note: if you run mongodb as a non-root user (recommended) you may
# need to create and set permissions for this directory manually,
# e.g., if the parent directory isn't mutable by the mongodb user.

<%
  config = node[:mongodb][@server_type]

  [
    # Basic Database Configuration
    :dbpath, # Location of the database files
    :port, # Port the mongod will listen on
    :logpath, # Full filename path to where log messages will be written
    :logappend, # Whether the log file will be appended (TRUE) or over-written (FALSE)

    # Logging
    :cpu, # Enable periodic logging (TRUE) of CPU utilization and I/O wait
    :verbose, # Verbose logging output

    # Administration & Monitoring
    :nohttpinterface, # Disable the HTTP interface. The default port is 1000 more than the dbport
    :rest, # Turn on simple rest API
    :noscripting, # Turns off server-side scripting. This will result in greatly limited functionality
    :notablescan, # Turns off table scans. Any query that would do a table scan fails
    :noprealloc, # Disable data file preallocation
    :nssize, # Specify .ns file size for new databases in MB
    :quota, # Enable quota management
    :quotaFiles, # Determines the number of files per Database (default is 8)

    # Sharding
    :shardsvr, # Indicates that this mongod will participate in sharding *Optional and just changes the default port

    # Journaling
    :journal # Whether writes will be journaled or not. This feature enables fast recovery from crashes


    # Set oplogging level where n is
    #   0=off (default)
    #   1=W
    #   2=R
    #   3=both
    #   7=W+some reads
    #:diaglog,
    #:nocursors, # Diagnostic/debugging option
    #:nohints, # Igonore query hints
    #:objcheck, # Inspect all client data for validity on receipt (useful for developing drivers)


  ].each do |option|
    if config[option] && !config[option].to_s.empty?
%>
<%= option %> = <%= config[option] %>
<%
    end
  end
%>

# Specific IP address that mongod will listen on
bind_ip = <%= config[:bind_ip].join(",")%>

# Security
<% if config[:auth] %>
# Turn on/off security. Off is currently the default
# Not sure if this was fixed, but auth=false didn't use to work
auth = true
<% else %>
noauth = true
<% end %>

# Mongo Monitoring Server
<% if config[:mms] %>
# Accout token for Mongo monitoring server.
mms-token = <%= config[:mms_token] %>

# Server name for Mongo monitoring server.
mms-name = <%= config[:mms_name] %>

# Ping interval for Mongo monitoring server.
mms-interval = <%= config[:mms_interval] %>
<% end %>

<% if config[:replication] %>

# Replication Options

# Automatically resync if slave data is stale
<%= "autoresync" if config[:autoresync] %>
# Indicate that this instance is starting from a dbpath snapshot of the repl peer
<% if config[:fastsync] %>
fastsync = <%= config[:fastsync] %>
<% end %>
# Size limit for in-memory storage of op ids in bytes
opIdMem = <%= config[:opidmem] * 1024 * 1024 %>
# Custom size for replication operation log in MB
oplogSize = <%= config[:oplogsize] %>

# Master-Slave Replication

# In replicated mongo databases, specify here whether this is a slave or master
<% if config[:slave] %>
slave = <%= config[:slave] %>
# Specify the	source ex. source = master.example.com
source = <%= config[:slave_source] %>
# Slave only: specify a single database to replicate
<% unless config[:slave_only].empty? %>
only = <%= config[:slave_only] %>
<% end %>
<% end %>
<% if config[:master] %>
# In replicated mongo databases, specify here whether this is a slave or master
master = <%= config[:master] %>
<% end %>

Replica Sets

<%
  [
    :replSet, # Use replica sets with the specified logical set name.  Typically the optional seed host list need not be specified
    :keyFile # Private key for cluster authentication
  ].each do |option|
    if config[option] && !config[option].to_s.empty?
%>
<%= option %> = <%= config[option] %>
<%
    end
  end
%>

<% end %>

